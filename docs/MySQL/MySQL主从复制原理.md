MySQL主从复制原理

什么是主从复制?

主从好处：
1、做数据的热备，数据安全备份
2、架构的扩展，业务数据分库存储
3、读写分离，使数据库能支撑更大的并发。

主从原理：
1、主库的binlog输出线程，输出binlog文件
2、从库的I/O线程接收binlog线程 ，接受binlog文件
3、从库的SQL线程，执行SQL的线程

mysql主从复制存在的问题：
主库宕机后，数据可能丢失
从库只有一个sql Thread，主库写压力大，复制很可能延时

解决方法：
半同步复制—解决数据丢失的问题
并行复制—-解决从库复制延迟的问题

---------------------------------------------------------------------------------------------------------------------

https://blog.csdn.net/qq_41772936/article/details/80380950
https://blog.csdn.net/DarkAngel1228/article/details/80004222
https://blog.csdn.net/darkangel1228/article/details/80003967
https://baijiahao.baidu.com/s?id=1617888740370098866&wfr=spider&for=pc


一、什么是主从复制?
主从复制，是用来建立一个和主数据库完全一样的数据库环境，称为从数据库；主数据库一般是准实时的业务数据库。

二、主从复制的作用（好处，或者说为什么要做主从）重点!
1、做数据的热备，作为后备数据库，主数据库服务器故障后，可切换到从数据库继续工作，避免数据丢失。
2、架构的扩展。业务量越来越大，I/O访问频率过高，单机无法满足，此时做多库的存储，降低磁盘I/O访问的频率，提高单个机器的I/O性能。
3、读写分离，使数据库能支撑更大的并发。在报表中尤其重要。由于部分报表sql语句非常的慢，导致锁表，影响前台服务。如果前台使用master，报表使用slave，那么报表sql将不会造成前台锁，保证了前台速度。

三、主从复制的原理（重中之重，面试必问）：
1.数据库有个bin-log二进制文件，记录了所有sql语句。
2.我们的目标就是把主数据库的bin-log文件的sql语句复制过来。
3.让其在从数据的relay-log重做日志文件中再执行一次这些sql语句即可。
4.下面的主从配置就是围绕这个原理配置
5.具体需要三个线程来操作：

1.binlog输出线程:每当有从库连接到主库的时候，主库都会创建一个线程然后发送binlog内容到从库。在从库里，当复制开始的时候，从库就会创建两个线程进行处理：
2.从库I/O线程:当START SLAVE语句在从库开始执行之后，从库创建一个I/O线程，该线程连接到主库并请求主库发送binlog里面的更新记录到从库上。从库I/O线程读取主库的binlog输出线程发送的更新并拷贝这些更新到本地文件，其中包括relay log文件。
3.从库的SQL线程:从库创建一个SQL线程，这个线程读取从库I/O线程写到relay log的更新事件并执行。

可以知道，对于每一个主从复制的连接，都有三个线程。拥有多个从库的主库为每一个连接到主库的从库创建一个binlog输出线程，每一个从库都有它自己的I/O线程和SQL线程。


mysql主从复制存在的问题：
主库宕机后，数据可能丢失
从库只有一个sql Thread，主库写压力大，复制很可能延时

解决方法：
半同步复制—解决数据丢失的问题
并行复制—-解决从库复制延迟的问题


半同步复制原理：
事务在主库写完binlog后需要从库返回一个已接受，才放回给客户端；
5.5集成到mysql，以插件的形式存在，需要单独安装
确保事务提交后binlog至少传输到一个从库
不保证从库应用完成这个事务的binlog
性能有一定的降低
网络异常或从库宕机，卡主库，直到超时或从库恢复 


mysql并行复制
社区版5.6中新增
并行是指从库多线程apply binlog库级别并行应用binlog，同一个库数据更改还是串行的(5.7版并行复制基于事务组)设置
设置sql线程数为10
set global slave_parallel_workers=10;

---------------------------------------------------------------------------------------------------------------------



